#!/usr/bin/env sh
set -eu

find_pinentry() {
  for candidate in "$@"; do
    if command -v "$candidate" >/dev/null 2>&1; then
      printf '%s\n' "$candidate"
      return 0
    fi
  done
  return 1
}

has_gui=0
if [ -n "${WAYLAND_DISPLAY-}" ] || [ -n "${DISPLAY-}" ]; then
  has_gui=1
fi

if [ "$has_gui" -eq 1 ]; then
  if pinentry_bin="$(find_pinentry pinentry-mac pinentry-gnome3 pinentry-gtk-2 pinentry-qt pinentry-qt5 pinentry-qt6 pinentry)"; then
    exec "$pinentry_bin"
  fi
fi

if pinentry_bin="$(find_pinentry pinentry-curses pinentry-tty pinentry)"; then
  exec "$pinentry_bin"
fi

exec pinentry
